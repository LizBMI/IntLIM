---
title: "NCI-60 BPO vs Leukemia Analysis"
author: "Jalal Siddiqui"
date: "7/19/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This vignette describes the analysis of NCI-60 data sets using IntLIM.  We compare the breast/prostate/ovarian cancers with leukemia and look for gene-metabolite correlations that significantly differ based on cancer type. The following packages are needed.  

```{r loadpackages}
rm(list = ls())
library(RColorBrewer)
library(pheatmap)
library(IntLim)
library(MultiDataSet)
```


## Loading Data using IntLIM

The data is contained in a series of .csv files.  nci60.csv contains a list of .csv files containing the gene expression data, metabolite abundance data, gene expression meta data, metabolite meta data, and the cell line meta data.  These have been filtered for a CV cutoff of less than 0.3 or.  From the analysis we have gene expression data consisting of 57 cell line samples and 17,987 genes.  We have metabolite abundance data consisting of 280 metabolites with 58 cell lines samples.  

```{r inputdata}
inputData <- IntLim::ReadData('nci60.csv',metabid='id',geneid='id')
IntLim::OutputStats(inputData)
```

We plan to filter the gene expression data by removing the genes with the lowest mean expression at the 10th percentile.  This reduces the total genes from 17,987 to 16,188.  

```{r filterdata}
inputDatafilt <- IntLim::FilterData(inputData,geneperc=10)
IntLim::OutputStats(inputDatafilt)
```

## Distribution of Gene and Metabolite Data

The distribution of the NCI-60 cell line data is shown below.  We can see that it is log2 transformed as well.   

```{r plotdist}
IntLim::PlotDistributions(inputDatafilt)
```
## Principal Component Analysis

The principal component analysis is run as follows.  
```{r pca.error}
#PlotPCA(inputDatafilt, stype = 'cancergroup')
#Error
```


```{r pca}
IntLim::PlotPCA(subset(MultiDataSet::commonSamples(inputDatafilt), , cancergroup == 'Leukemia' | cancergroup == 'BPO'), stype = 'cancergroup')
```

## Running Linear Model

The linear model is run as below.  "cancergroup" is selected as the stype as we will be dividing groups based on androgen cancers vs leukemia.  RunIntLim will calculate p-values for the (g:t) interaction term describing how the gene-metabolite relationship varies based on cancer type.    

```{r runintlim}
myres <- IntLim::RunIntLim(inputDatafilt,stype="cancergroup")
#IntLim::DistPvalues(myres)
```

```{r distpvals}
#IntLim::DistPvalues(myres)
#Get Error

```

We then proceed to process the results filtering by FDR adjusted p values of 0.10 or less and a difference in gene-metabolite correlations of 0.50 or more.  We have a total of 495 correlations.  

```{r processresults}
myres <- IntLim::ProcessResults(myres,inputDatafilt, diffcorr = 0, pvalcutoff = 0.10)
IntLim::CorrHeatmap(myres)
```

Another heatmap can be plotted using pheatmap.  This allows for clustering of gene-metabolite pairs.  

```{r heatmap}
mycols=colorRampPalette(brewer.pal(5,"PiYG")) (255)[255:1]

myheat=pheatmap(myres@corr[,c(3,4)],col=mycols,cutree_rows=5,
main="NCI-60 Gene-Metabolite Correlations", show_rownames = F, cluster_cols = FALSE)

```